<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Component Example</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="flex flex-col justify-center items-center h-screen">
    <div class="container h-screen flex flex-col gap-6">
      <x-component echo="chao">hola</x-component>
      <!--r-scope
        state='{name: "John", age: 20, isEditing: false, userFruits: [{emoji: "üçé", quantity: 10}, {emoji: "üçå", quantity: 10}], profile: {name: "John", age: 20}}'
      >
        <p class="text-2xl font-bold flex items-center gap-2">
          este es <r-var name="$state.name">___</r-var> y tiene
          <span
            class="flex flex-col relative w-10 bg-gray-100 rounded-md items-center justify-center"
          >
            <r-on event="wheel" handler="increment($state.age)"></r-on>
            <r-on event="mouseover" handler="$state.isEditing = true"></r-on>
            <r-on event="mouseout" handler="$state.isEditing = false"></r-on>
            <r-if when="$state.isEditing">
              <template>
                <button
                  class="bg-gray-200 w-10 absolute -top-10 left-0 right-0 mx-auto hover:text-white hover:bg-blue-500 active:bg-blue-600 p-1 rounded-md cursor-pointer"
                >
                  <r-on event="click" handler="increment($state.age)"></r-on>
                  +
                </button>
              </template>
            </r-if>
            <r-var name="$state.age">00</r-var>
            <r-if when="$state.isEditing">
              <template>
                <button
                  class="bg-gray-200 w-10 absolute -bottom-10 left-0 right-0 mx-auto hover:text-white hover:bg-blue-500 active:bg-blue-600 p-1 rounded-md cursor-pointer"
                >
                  <r-on event="click" handler="decrement($state.age)"></r-on>
                  -
                </button>
              </template>
            </r-if>
          </span>
          a√±os
        </p>
        <script>
          const fruits = [
            'üçé',
            'üçå',
            'üçä',
            'üçá',
            'üçê',
            'üçë',
            'üçì',
            'ü•ù',
            'ü•≠',
            'üçç',
          ];

          const useState = () => document.querySelector('r-scope').getSignals();

          document.addEventListener('DOMContentLoaded', () => {
            const { age } = useState();
            console.log('Document ready, initial age:', age.value);

            function increment() {
              // esto no sirve desde afuera
              console.log(age, age.value);

              age.value++;
            }
          });

          function increment(age) {
            age.value++;
          }

          function decrement(age) {
            age.value--;
          }

          function addFruit(list) {
            const randomIndex = Math.floor(Math.random() * fruits.length);
            const randomFruit = fruits[randomIndex];
            const randomQuantity = Math.floor(Math.random() * 10) + 1;
            const newFruit = { emoji: randomFruit, quantity: randomQuantity };
            list.value = [...list.value, newFruit];
          }

          function removeFruit(array, item) {
            array.value = array.value.filter(i => i !== item.value);
          }

          function removeLastFruit(array) {
            array.value = array.value.slice(0, -1);
          }
        </script>

        <r-if when="$state.age > 18">
          <template>
            <div class="text-green-500">Es mayor de edad</div>
          </template>

          <template id="else">
            <div class="text-red-500">Es menor de edad</div>
          </template>
        </r-if>

        <div>
          <div class="flex gap-2">
            <r-for each="$state.userFruits" as="item" class="flex gap-2 my-3">
              <template>
                <button
                  class="cursor-pointer border border-gray-300 rounded-md p-1 hover:bg-gray-100"
                >
                  <r-on
                    event="click"
                    handler="removeFruit($state.userFruits, $state.item)"
                  ></r-on>
                  <r-var name="$state.item.quantity">0</r-var>
                  <r-var name="$state.item.emoji">-</r-var>
                </button>
              </template>
            </r-for>
          </div>
          <button class="btn">
            <r-on event="click" handler="addFruit($state.userFruits)"></r-on>
            add
          </button>
          <button class="btn">
            <r-on
              event="click"
              handler="removeLastFruit($state.userFruits)"
            ></r-on>
            remove
          </button>
        </div>
        <r-var name="$state.profile.name">00</r-var>

        <dialog id="tooMuchFruitDialog">
          <r-attr name="open" value="$state.userFruits.length > 5"></r-attr>
          <div
            class="h-screen w-screen bg-gray-500/30 fixed top-0 bottom-0 left-0 right-0 flex items-center justify-center"
          >
            <div class="bg-white p-4 rounded-lg shadow-lg">
              <h1 class="text-xl font-bold mb-4">¬°Advertencia!</h1>
              <p class="mb-4">
                <r-var name="$state.userFruits.length"></r-var>
                son demasiadas frutas!<br />
                üçéüçåüçä
              </p>
              <form method="dialog">
                <button
                  class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                >
                  Cerrar
                </button>
              </form>
              <button class="btn">
                <r-on
                  event="click"
                  handler="removeLastFruit($state.userFruits)"
                ></r-on>
                remove
              </button>
            </div>
          </div>
        </dialog>
      </r-scope-->
    </div>
    <script type="module" src="lib/main.ts" defer></script>
  </body>
</html>
